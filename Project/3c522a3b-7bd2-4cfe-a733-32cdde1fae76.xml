<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>CASE diStato OF&#xD;
	0:	Q_sResult:='Triggerato M100';&#xD;
		IF&#xD;
			READ_MCODE_M100.Strobe&#xD;
		THEN&#xD;
			lrTraverse:=50.0;&#xD;
			lrSpessoreFilo:=0.1;&#xD;
			diStato:=1;&#xD;
		END_IF;&#xD;
	1:	Q_sResult:='Attesa Motion Program in Pausa';&#xD;
		IF&#xD;
			CncCsStatus[0].Sta.CsCtrlOutputs.ExecutingStatus=_eCNC_EXECUTING_STATE#_cncHold&#xD;
		THEN&#xD;
			diStato:=2;&#xD;
		END_IF;&#xD;
	2:	Q_sResult:='Pausa da Eliminare';&#xD;
		IF&#xD;
			SetPosMandrino.Done&#xD;
		THEN&#xD;
			lrSyncPosX:=_CNC_Coord[0].AxActPos.X;&#xD;
			lrStartPosX:=lrSyncPosX;&#xD;
			lrStartEncPos:=(MC_Mandrino.Act.Pos/360.0)*lrSpessoreFilo;&#xD;
			lrInversione:=lrSyncPosX+lrTraverse;&#xD;
			diStato:=3;&#xD;
		END_IF;&#xD;
	3:&#xD;
		IF&#xD;
			SYNC_MOVE_X.InPosition&#xD;
		THEN&#xD;
			diStato:=4;&#xD;
		END_IF;&#xD;
	4:  Q_sResult:='Parto in avanti';&#xD;
		IF&#xD;
			lrSyncPosX&lt;lrInversione-lrSpessoreFilo&#xD;
		THEN&#xD;
			lrEncPos:=(MC_Mandrino.Act.Pos/360.0)*lrSpessoreFilo;		&#xD;
			lrSyncPosX:=ScaleTrans(&#xD;
													SclIn:=lrEncPos, &#xD;
													X0:=lrStartEncPos, &#xD;
													Y0:=0.0, &#xD;
													X1:=lrTraverse+lrStartEncPos, &#xD;
													Y1:=lrTraverse, &#xD;
													SclOfs:=lrStartPosX);&#xD;
		ELSE&#xD;
			lrEndPosX:=lrSyncPosX-lrStartPosX;&#xD;
			lrStartEncPos:=lrEncPos;&#xD;
			diStato:=41;&#xD;
		END_IF;&#xD;
	41:&#xD;
		Q_sResult:='Parto in Indietro';&#xD;
		IF&#xD;
			lrSyncPosX&gt;lrStartPosX&#xD;
		THEN&#xD;
			lrEncPos:=(MC_Mandrino.Act.Pos/360.0)*lrSpessoreFilo;		&#xD;
			lrSyncPosX:=ScaleTrans(&#xD;
													SclIn:=lrEncPos, &#xD;
													X0:=lrStartEncPos, &#xD;
													Y0:=lrEndPosX, &#xD;
													X1:=lrTraverse+lrStartEncPos, &#xD;
													Y1:=0.0, &#xD;
													SclOfs:=lrStartPosX);&#xD;
		ELSE&#xD;
			diStato:=5;&#xD;
		END_IF;&#xD;
	5:&#xD;
		IF&#xD;
			STOP_MOVE_X.Done&#xD;
			AND&#xD;
			IFB_MOVE_BOBINATURA.Done&#xD;
		THEN&#xD;
			diStato:=9;&#xD;
		END_IF;&#xD;
	9:&#xD;
		IF&#xD;
			NOT READ_MCODE_M100.Strobe&#xD;
		THEN&#xD;
			diStato:=10;&#xD;
		END_IF;&#xD;
	10:&#xD;
		IF&#xD;
			CncCsStatus[0].Sta.CsCtrlOutputs.ExecutingStatus=_eCNC_EXECUTING_STATE#_cncExecuting&#xD;
		THEN&#xD;
			diStato:=0;&#xD;
		END_IF;	&#xD;
END_CASE;&#xD;
&#xD;
G_xM100_FEED_HOLD:=diStato=1;&#xD;
G_xM100_CYCLE_START:=diStato=10;&#xD;
&#xD;
READ_MCODE_M100(&#xD;
	Coord:=_CNC_Coord[0], &#xD;
	MCode:=sMCODE, &#xD;
	Enable:=TRUE, &#xD;
	MCodeNo:=100);&#xD;
DELAT_M100(&#xD;
	In:=diStato=2, &#xD;
	PT:=T#0s);&#xD;
SYNC_MOVE_X(&#xD;
	Coord:=_CNC_Coord[0], &#xD;
	Execute:=diStato=3, &#xD;
	LogicalMotorNo:=0, &#xD;
	Position:=lrSyncPosX &#xD;
	);&#xD;
POWER_MANDRINO(&#xD;
	Axis:=MC_Mandrino, &#xD;
	Enable:=TRUE);&#xD;
SetPosMandrino(&#xD;
	Axis:=MC_Mandrino, &#xD;
	Execute:=diStato=2, &#xD;
	Position:=0.0, &#xD;
	ReferenceType:=_eMC_REFERENCE_TYPE#_mcCommand, &#xD;
	Relative:=FALSE, &#xD;
	ExecutionMode:=_eMC_EXECUTION_MODE#_mcImmediately);&#xD;
IFB_MOVE_BOBINATURA(&#xD;
	Axis:=MC_Mandrino, &#xD;
	Execute:=diStato=4, &#xD;
	Position:=1000*360.0, &#xD;
	Velocity:=36000.0, &#xD;
	Acceleration:=7200.0, &#xD;
	Deceleration:=7200.0, &#xD;
	Jerk:=0.0, &#xD;
	Direction:=_eMC_DIRECTION#_mcNoDirection, &#xD;
	BufferMode:=_eMC_BUFFER_MODE#_mcAborting);&#xD;
STOP_MOVE_X(&#xD;
	Coord:=_CNC_Coord[0], &#xD;
	Execute:=diStato=5, &#xD;
	Deceleration:=alrDEC);&#xD;
STOP_MANDRINO(&#xD;
	Axis:=MC_Mandrino, &#xD;
	Execute:=diStato=0 AND MC_Mandrino.Status.Discrete, &#xD;
	Deceleration:=1000.0, &#xD;
	Jerk:=0.0, &#xD;
	BufferMode:=_eMC_BUFFER_MODE#_mcAborting &#xD;
	);&#xD;
RESET_MCODE(&#xD;
	Coord:=_CNC_Coord[0], &#xD;
	Execute:=diStato=9 &#xD;
	);</Text></StructuredTextModel>